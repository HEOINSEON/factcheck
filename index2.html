<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미디어 리터러시: 팩트체크 8대 원칙 챌린지</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter & Noto Sans KR Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+KR:wght@400;700&display=swap');
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .fact-button {
            transition: all 0.2s;
            min-height: 4.5rem; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
        }
        .fact-button:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .fact-button.disabled {
            cursor: default;
            opacity: 0.7;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
        }
        .principle-item {
            cursor: pointer;
            transition: all 0.15s;
        }
        .principle-item:hover {
            background-color: #f0f9ff;
            border-color: #38bdf8;
        }
        .principle-item.selected {
            background-color: #e0f2fe;
            border-color: #06b6d4;
            box-shadow: 0 4px 6px rgba(6, 182, 212, 0.2);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-2xl bg-white rounded-xl shadow-2xl p-6 md:p-8 transform transition-all duration-500">
        
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-extrabold text-teal-600 mb-2">
                팩트체크 8대 원칙 챌린지
            </h1>
            <p class="text-gray-500 text-sm md:text-base">정보 검증의 핵심 기준을 학습하고 적용해보세요.</p>
        </header>

        <!-- Principles Introduction Screen (STEP 1: 학습) -->
        <div id="intro-screen">
            <h2 class="text-xl font-bold text-sky-700 mb-4 border-b pb-2">핵심 원칙 학습하기 (클릭하여 상세 정보 확인)</h2>
            
            <div class="md:flex md:space-x-4">
                
                <!-- 8대 원칙 버튼 리스트 -->
                <div id="principle-list" class="flex flex-col gap-2 md:w-1/3 md:space-y-2 mb-4 md:mb-0 max-h-96 overflow-y-auto custom-scrollbar p-1">
                    <!-- Buttons generated by JS -->
                </div>

                <!-- 상세 설명 및 예시 표시 영역 -->
                <div id="principle-detail-display" class="md:w-2/3 p-4 bg-sky-50 border border-sky-200 rounded-lg shadow-inner">
                    <h3 id="detail-title" class="text-xl font-bold text-teal-600 mb-3 border-b border-teal-200 pb-1">원칙을 선택하여 학습을 시작하세요.</h3>
                    
                    <div class="space-y-4">
                        <p class="text-md font-semibold text-gray-700">상세 설명</p>
                        <p id="detail-explanation" class="text-gray-700 text-sm leading-relaxed">왼쪽에서 원칙 하나를 선택하면 해당 원칙의 정의와 실제 적용 예시를 확인할 수 있습니다.</p>
                        
                        <p class="text-md font-semibold text-gray-700 border-t pt-3">적용 예시</p>
                        <p id="detail-example" class="text-gray-600 text-sm italic leading-relaxed">예시를 통해 해당 원칙이 어떤 상황에 가장 먼저 적용되어야 하는지 배울 수 있습니다.</p>
                    </div>
                </div>
            </div>
            
            <button id="start-challenge-button" class="mt-6 w-full py-3 font-semibold rounded-xl bg-teal-500 text-white hover:bg-teal-600 shadow-xl shadow-teal-300/50 transition duration-200" onclick="showUserInfoScreen()">
                ✅ 챌린지 시작하기
            </button>
        </div>

        <!-- User Info Screen (STEP 2: 정보 입력) -->
        <div id="user-info-screen" class="hidden">
            <h2 class="text-2xl font-bold text-sky-700 mb-6 text-center">도전자 정보 입력</h2>
            <div class="space-y-4">
                <p id="info-error-message" class="text-sm text-red-500 font-medium hidden"></p>
                
                <!-- 학번 입력 -->
                <div>
                    <label for="student-id" class="block text-sm font-medium text-gray-700 mb-1">학번 (숫자 5자리)</label>
                    <input type="text" id="student-id" placeholder="예: 12345" maxlength="5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition duration-150">
                </div>
                
                <!-- 이름 입력 -->
                <div>
                    <label for="student-name" class="block text-sm font-medium text-gray-700 mb-1">이름</label>
                    <input type="text" id="student-name" placeholder="이름을 입력하세요" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition duration-150">
                </div>
            </div>

            <div class="mt-8 flex space-x-4">
                <button class="w-1/3 py-3 font-semibold rounded-xl bg-gray-300 text-gray-800 hover:bg-gray-400 transition duration-200" onclick="showIntroScreen()">
                    ← 원칙 학습으로
                </button>
                <button class="w-2/3 py-3 font-semibold rounded-xl bg-teal-500 text-white hover:bg-teal-600 shadow-xl shadow-teal-300/50 transition duration-200" onclick="validateAndStartQuiz()">
                    퀴즈 시작!
                </button>
            </div>
        </div>


        <!-- Scoreboard and Status (Only visible during quiz) -->
        <div id="scoreboard" class="flex items-center justify-between mb-6 p-3 bg-teal-50 rounded-lg shadow-inner border border-teal-200 hidden">
            <!-- Back Button / Status Group -->
            <div class="flex items-center space-x-3">
                <button onclick="returnToUserInfo()" class="text-sm font-medium text-gray-600 hover:text-gray-800 bg-teal-100 px-3 py-1 rounded-full transition duration-150">
                    ← 정보 입력으로
                </button>
                <p class="text-lg font-semibold text-teal-700">
                    <span id="current-index-display">1</span> / <span id="total-items-display"></span> 항목
                </p>
            </div>
            
            <!-- Score & User Info -->
            <div class="text-right">
                 <p class="text-xs text-gray-600"><span id="user-info-display"></span></p>
                <p class="text-xl font-bold text-green-600">
                    점수: <span id="score-display">0</span>점
                </p>
            </div>
        </div>

        <!-- Main Quiz Card Section (STEP 3 - Hidden initially) -->
        <div id="quiz-card" class="hidden">
            
            <!-- Fact Check Item -->
            <div class="bg-sky-50 border-l-4 border-sky-500 p-5 rounded-lg shadow-md mb-6 h-40 flex flex-col justify-center">
                <p class="text-sm font-semibold text-sky-700 mb-2">문제 상황 (가정된 정보):</p>
                <p id="statement-text" class="text-lg font-bold text-gray-800 leading-relaxed">
                    로딩 중...
                </p>
            </div>

            <p class="text-md font-semibold text-gray-700 mb-4 text-center">
                이 정보를 검증할 때, 가장 먼저 적용해야 할 핵심 원칙은 무엇일까요?
            </p>

            <!-- Principle Buttons Container -->
            <div id="answer-buttons" class="grid grid-cols-2 gap-3">
                <!-- Buttons will be generated by JavaScript -->
            </div>

            <!-- Feedback Area (Hidden initially) -->
            <div id="feedback-area" class="mt-6 p-4 rounded-xl shadow-lg border hidden transition-all duration-300">
                <h3 id="feedback-title" class="text-xl font-bold mb-2"></h3>
                <p id="correct-answer-info" class="text-sm font-semibold text-gray-600 mb-3 hidden">
                    정답 원칙: <span id="correct-principle-text" class="text-sky-600 font-bold"></span>
                </p>
                
                <!-- 힌트 / 설명 영역 -->
                <div class="max-h-36 overflow-y-auto custom-scrollbar">
                    <p id="hint-text" class="text-orange-600 font-semibold mb-2 hidden"></p>
                    <p id="explanation-text" class="text-gray-700"></p>
                </div>

                <!-- Combined Navigation Buttons -->
                <div class="mt-4 flex space-x-3">
                    <button id="prev-button" class="w-1/2 py-2 font-semibold rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition duration-150 hidden" onclick="previousItem()">
                        ← 이전 문제로
                    </button>
                    <!-- [수정]: nextItem() 클릭 핸들러 추가 -->
                    <button id="next-button" class="w-full py-2 font-semibold rounded-lg bg-teal-500 text-white opacity-50 cursor-not-allowed transition duration-150" disabled onclick="nextItem()">
                        다음 문제로 (정답을 맞추세요)
                    </button>
                </div>
            </div>
            
        </div>

        <!-- Completion Screen (STEP 4 - Hidden initially) -->
        <div id="completion-screen" class="text-center p-8 hidden">
            <h2 class="text-3xl font-bold text-teal-600 mb-4">학습 완료! 🎉</h2>
             <p class="text-md text-gray-700 mb-2 font-semibold"><span id="final-user-info-display"></span>님의</p>
            <p class="text-xl text-gray-700 mb-6">최종 점수는...</p>
            <p class="text-5xl font-extrabold text-teal-500 mb-8">
                <span id="final-score-display">0</span>점
            </p>
            <p class="text-gray-600 mb-6">팩트체크 8대 원칙 챌린지를 모두 완료하셨습니다. 수고하셨습니다!</p>
            <button class="py-3 px-6 text-lg font-bold rounded-xl bg-sky-500 text-white hover:bg-sky-600 shadow-xl shadow-sky-300/50 transition duration-200" onclick="showIntroScreen()">
                🔄 처음으로 돌아가기
            </button>
        </div>

    </div>

    <script type="text/javascript">
        // 8대 팩트체크 원칙 정의 (학습 화면 및 퀴즈에 사용)
        const principles = {
            'Source': { 
                text: '🔍 출처 신뢰도', 
                detail: '정보를 제공하는 주체가 전문가인지, 공신력 있는 기관인지, 그리고 그들이 정보를 왜 제공하는지 확인합니다.',
                example: '공식적인 정부 정책 뉴스를 익명의 블로거가 아닌 정부 발표 채널이나 공신력 있는 언론 보도를 통해 확인하는 것.',
                color: 'bg-sky-500', shadow: 'shadow-sky-300/50', hint: '누가 이 정보를 제공했나요? 믿을 만한 곳인가요?'
            },
            'Evidence': { 
                text: '📜 증거 자료 확인', 
                detail: '주장을 뒷받침하는 통계, 사진, 문서 등의 증거가 충분하고 객관적인지, 그리고 증거 자체가 조작되진 않았는지 검증합니다.',
                example: '특정 통계 수치를 인용했다면, 해당 통계의 원본 자료(예: 정부 보고서)를 찾아 수치와 조사 방법을 확인하는 것.',
                color: 'bg-indigo-500', shadow: 'shadow-indigo-300/50', hint: '주장 말고, 실제로 보여주는 객관적인 자료가 충분한가요?'
            },
            'Date': { 
                text: '⏱️ 날짜/시점 파악', 
                detail: '정보가 최신 정보인지, 오래된 정보가 새로운 사건인 것처럼 재사용된 것은 아닌지 확인하여 맥락의 오류를 방지합니다.',
                example: '현재 유행하는 질병에 대한 기사에 첨부된 사진이 10년 전 자료라면, 해당 사진을 이용해 현 상황을 판단하지 않는 것.',
                color: 'bg-orange-500', shadow: 'shadow-orange-300/50', hint: '이 정보가 지금, 오늘 발생한 일에 대한 이야기인가요?'
            },
            'Context': { 
                text: '🖼️ 전체 맥락 이해', 
                detail: '부분적인 인용이나 사진만으로 판단하지 않고, 정보가 원래 속했던 전체 이야기나 상황을 파악하여 왜곡을 피합니다.',
                example: '정치인이 농담으로 했던 발언을 심각한 정책 발언으로 편집해 보도했다면, 전체 연설 영상을 확인하여 원래 의도를 파악하는 것.',
                color: 'bg-pink-500', shadow: 'shadow-pink-300/50', hint: '이것이 전체 이야기의 일부만 잘라낸 것은 아닌가요?'
            },
            'Bias': { 
                text: '🗣️ 의도/편향성 분석', 
                detail: '정보 전달자(매체, 개인)가 특정 정치적, 경제적, 사회적 의도를 가지고 있지 않은지, 또는 감정적으로 편향되어 있지 않은지 분석합니다.',
                example: '특정 제품을 칭찬하는 기사가 사실은 그 기업의 후원으로 작성된 광고인지 아닌지 확인하고 비판적으로 받아들이는 것.',
                color: 'bg-red-500', shadow: 'shadow-red-300/50', hint: '이 정보를 누가, 왜 만들었을까요? 혹시 감정적으로 치우치진 않았나요?'
            },
            'Logic': { 
                text: '💡 논리적 오류 검토', 
                detail: '주장과 근거가 합리적으로 연결되는지, 비약이나 잘못된 인과 관계(A 때문에 B가 일어났다는 식)가 없는지 논리 구조를 살핍니다.',
                example: '"우리 회사가 작년에 세계 최고의 기술을 개발했으니, 올해 모든 신제품은 무조건 성공할 것이다"와 같은 비약적 주장을 경계하는 것.',
                color: 'bg-yellow-500', shadow: 'shadow-yellow-300/50', hint: '주장과 근거 사이에 빠진 논리적인 연결고리가 있나요?'
            },
            'CrossCheck': { 
                text: '🔗 교차 확인 (다른 출처)', 
                detail: '하나의 정보만 믿지 않고, 공신력 있는 최소 2~3개의 독립적인 출처에서 같은 사실을 보도하고 있는지 비교 확인합니다.',
                example: '단 하나의 매체만 보도한 충격적인 사건에 대해, 다른 주요 언론사들이나 공식 채널에서도 같은 내용을 보도하는지 검색해보는 것.',
                color: 'bg-teal-500', shadow: 'shadow-teal-300/50', hint: '다른 믿을 만한 곳에서도 같은 이야기를 하고 있나요?'
            },
            'Type': { 
                text: '🧩 정보 유형 분류', 
                detail: '보고 있는 콘텐츠가 사실(Fact)인지, 의견(Opinion)인지, 광고(Ad)인지, 풍자(Satire)인지 등 정보의 본래 유형을 정확히 분류합니다.',
                example: '코미디 프로그램에서 특정 사회 현상을 풍자한 내용을 실제 뉴스 기사로 오해하지 않고 오락 콘텐츠로 받아들이는 것.',
                color: 'bg-green-500', shadow: 'shadow-green-300/50', hint: '이것이 사실(Fact)인가요, 아니면 주장이나 광고인가요?'
            },
        };
        const principleKeys = Object.keys(principles);

        // 팩트체크 학습 문항 데이터 (퀴즈에 사용)
        const factChecks = [
            {
                statement: "어떤 유튜브 채널에서 '내년에 정부가 발표할 예정인 부동산 정책의 비밀 자료'라며 출처 불명의 문서를 공개했습니다.",
                correct_principle: "Source",
                explanation: "공식적인 정부 정책이나 비밀 자료는 반드시 정부 부처나 공신력 있는 언론사의 보도를 통해 확인해야 합니다. 출처가 불분명한 정보는 신뢰할 수 없으며, 출처가 공신력이 있는지를 확인하는 것이 가장 중요합니다.",
                userAnswer: null, 
                isCorrectlyAnswered: false,
                attempts: 0 // 시도 횟수 추적을 위해 추가
            },
            {
                statement: "한 SNS 게시물에 '현재 A 도시에서 대규모 폭동이 발생하고 있다'는 문구와 함께 5년 전 다른 국가에서 촬영된 시위 사진이 첨부되었습니다.",
                correct_principle: "Date",
                explanation: "정보가 유포된 시점과 실제 사건이 발생한 시점, 그리고 사진이 촬영된 시점을 비교해야 합니다. 오래된 자료나 다른 맥락의 자료를 현재의 사건인 것처럼 오용하는 경우가 흔합니다. (날짜와 시점의 정확성)",
                userAnswer: null,
                isCorrectlyAnswered: false,
                attempts: 0
            },
            {
                statement: "환경 관련 기사에서 '모든 과학자가 B 기업의 신기술이 지구를 파괴한다고 말하고 있다'고 주장했으나, 실제 인용한 전문가는 3명뿐이었습니다.",
                correct_principle: "Evidence",
                explanation: "'모든 과학자'와 같은 과장된 표현과 달리 제시된 증거(인용한 전문가 수)가 미약하거나 불분명합니다. 주장을 뒷받침하는 증거가 객관적이고 충분한지 확인하는 것이 필수입니다.",
                userAnswer: null,
                isCorrectlyAnswered: false,
                attempts: 0
            },
            {
                statement: "특정 정치인을 비판하는 글에서, 그가 과거에 했던 단순한 농담을 현재의 심각한 정책 문제와 연결 지어 그의 무능함을 강조하는 내용.",
                correct_principle: "Context",
                explanation: "정보가 원래 사용된 상황(맥락)과 현재 제시되는 맥락이 일치하는지 확인해야 합니다. 단순 농담이 심각한 정책 발언으로 둔갑하는 것처럼, 부분적인 발언이나 사진을 자극적인 맥락으로 끼워 맞추는 경우가 많습니다.",
                userAnswer: null,
                isCorrectlyAnswered: false,
                attempts: 0
            },
            {
                statement: "댓글에 '이 기사는 완전히 선동적이며, 기자는 C당의 스파이임이 틀림없다'와 같이 감정을 자극하는 내용이 가득한 게시물.",
                correct_principle: "Bias",
                explanation: "정보 전달자가 중립적인 시각을 유지하고 있는지, 아니면 특정 목적을 가지고 감정적으로 편향된 주장을 하는지 분석해야 합니다. 극단적인 언어나 감정적인 표현은 편향성을 나타내는 신호입니다.",
                userAnswer: null,
                isCorrectlyAnswered: false,
                attempts: 0
            },
            {
                statement: "D 회사가 '우리는 E 제품을 시장에서 1위로 만들었으므로, F 제품도 무조건 시장에서 성공할 것이다'라고 광고하는 내용.",
                correct_principle: "Logic",
                explanation: "두 주장이 논리적으로 연결되는지 검토해야 합니다. 한 분야의 성공이 다른 분야의 성공을 보장하지 않는 것처럼, 비약적이거나 잘못된 인과 관계를 주장하는 논리적 오류를 찾아내야 합니다. (논리의 비약 확인)",
                userAnswer: null,
                isCorrectlyAnswered: false,
                attempts: 0
            },
            {
                statement: "한 방송사가 '최근 유행하는 C 질병 치료법 발견' 기사를 보도했으나, 다른 공신력 있는 언론사나 보건 당국에서는 관련 보도가 전혀 없습니다.",
                correct_principle: "CrossCheck",
                explanation: "매우 중요하거나 파급력이 큰 정보일수록 여러 독립적인 출처를 통해 사실을 교차 확인해야 합니다. 하나의 출처만 믿고 정보를 수용하는 것은 위험합니다.",
                userAnswer: null,
                isCorrectlyAnswered: false,
                attempts: 0
            },
            {
                statement: "뉴스 기사처럼 보이지만 사실은 특정 기업의 제품을 홍보하기 위해 제작된 '기사 형태의 광고(네이티브 광고)'인 경우.",
                correct_principle: "Type",
                explanation: "우리가 접하는 정보가 뉴스인지, 의견 칼럼인지, 아니면 광고인지 그 본질적인 유형을 파악해야 합니다. 정보의 유형을 잘못 분류하면 비판적 사고를 적용할 수 없습니다. (정보의 본래 목적 확인)",
                userAnswer: null,
                isCorrectlyAnswered: false,
                attempts: 0
            },
        ];

        let currentItemIndex = 0;
        let score = 0;
        let studentInfo = { id: '', name: '' };
        
        document.getElementById('total-items-display').textContent = factChecks.length;

        // --- 점수 계산 로직 추가 ---
        /**
         * 시도 횟수에 따라 점수를 계산하는 함수입니다.
         * @param {number} totalAttempts - 정답을 맞추는 데 걸린 총 시도 횟수 (1회부터)
         * @returns {number} 계산된 점수
         */
        function getScoreForAttempts(totalAttempts) {
            if (totalAttempts === 1) return 30;
            if (totalAttempts === 2) return 20;
            if (totalAttempts === 3) return 10;
            if (totalAttempts === 4) return 5;
            return 0; // 5회 이상 시도
        }
        // --- 화면 전환 및 초기화 함수 ---
        
        // 모든 화면을 숨기는 유틸리티
        function hideAllScreens() {
            ['intro-screen', 'user-info-screen', 'scoreboard', 'quiz-card', 'completion-screen'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
        }

        function showScreen(id) {
            hideAllScreens();
            document.getElementById(id).classList.remove('hidden');
        }

        /**
         * 초기 학습 화면을 표시하고 8대 원칙 설명을 채웁니다. (STEP 1)
         */
        function showIntroScreen() {
            showScreen('intro-screen');
            
            const listContainer = document.getElementById('principle-list');
            listContainer.innerHTML = ''; // 기존 내용 초기화

            // 8대 원칙 버튼 생성
            principleKeys.forEach(key => {
                const p = principles[key];
                const button = document.createElement('button');
                
                button.className = 'principle-item w-full text-sm font-semibold py-2 px-3 border rounded-lg text-teal-700 bg-white hover:bg-sky-50 transition duration-150';
                button.setAttribute('data-key', key);
                button.setAttribute('onclick', `showPrincipleDetail('${key}')`);
                button.textContent = p.text;
                listContainer.appendChild(button);
            });
        }
        
        /**
         * 선택된 원칙의 상세 정보(설명 및 예시)를 표시합니다.
         */
        function showPrincipleDetail(key) {
            const p = principles[key];

            // 1. 상세 영역 업데이트
            document.getElementById('detail-title').textContent = p.text;
            document.getElementById('detail-explanation').textContent = p.detail;
            document.getElementById('detail-example').textContent = p.example;

            // 2. 버튼 하이라이트 변경
            const listContainer = document.getElementById('principle-list');
            listContainer.querySelectorAll('.principle-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`.principle-item[data-key="${key}"]`).classList.add('selected');
        }

        /**
         * 사용자 정보 입력 화면을 표시합니다. (STEP 2)
         */
        function showUserInfoScreen() {
            showScreen('user-info-screen');
            document.getElementById('student-id').value = studentInfo.id;
            document.getElementById('student-name').value = studentInfo.name;
            document.getElementById('info-error-message').classList.add('hidden');
        }

        /**
         * 사용자 정보를 검증하고 퀴즈를 시작합니다.
         */
        function validateAndStartQuiz() {
            const studentId = document.getElementById('student-id').value.trim();
            const studentName = document.getElementById('student-name').value.trim();
            const errorElement = document.getElementById('info-error-message');
            
            errorElement.classList.add('hidden');
            
            // 학번 유효성 검사 (5자리 숫자)
            if (!/^\d{5}$/.test(studentId)) {
                errorElement.textContent = "⚠️ 학번은 정확히 5자리의 숫자여야 합니다.";
                errorElement.classList.remove('hidden');
                return;
            }

            // 이름 유효성 검사
            if (studentName.length < 2) {
                errorElement.textContent = "⚠️ 이름을 2자 이상 입력해주세요.";
                errorElement.classList.remove('hidden');
                return;
            }
            
            // 정보 저장
            studentInfo = { id: studentId, name: studentName };

            // 퀴즈 시작
            startQuiz();
        }

        /**
         * 퀴즈를 초기화하고 퀴즈 화면을 표시합니다.
         */
        function startQuiz() {
            currentItemIndex = 0;
            score = 0;

            // 문제 상태 초기화
            factChecks.forEach(item => {
                item.userAnswer = null;
                item.isCorrectlyAnswered = false;
                item.attempts = 0; // 시도 횟수 초기화
            });

            showQuizCard();
        }

        /**
         * 퀴즈 카드와 점수판을 표시합니다. (STEP 3)
         */
        function showQuizCard() {
            hideAllScreens();
            document.getElementById('scoreboard').classList.remove('hidden');
            document.getElementById('quiz-card').classList.remove('hidden');
            
            // 사용자 정보 업데이트
            document.getElementById('user-info-display').textContent = `${studentInfo.id} / ${studentInfo.name}`;
            
            displayCurrentItem();
        }
        
        /**
         * 퀴즈 진행 중 사용자 정보 입력 화면으로 돌아갑니다.
         */
        function returnToUserInfo() {
            // 퀴즈 진행 상황(점수, 진행도)은 유지한 채 화면만 전환
            showUserInfoScreen();
        }

        // --- 퀴즈 로직 ---
        
        /**
         * 배열을 섞는 유틸리티 함수 (Fisher-Yates)
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * 다음 문제로 이동합니다. (정답을 맞춘 후에만 호출 가능)
         */
        function nextItem() {
            currentItemIndex++;
            displayCurrentItem();
        }

        /**
         * 이전 문제로 이동합니다.
         */
        function previousItem() {
            if (currentItemIndex > 0) {
                currentItemIndex--;
                displayCurrentItem();
            }
        }

        /**
         * 챌린지 항목을 화면에 표시합니다.
         */
        function displayCurrentItem() {
            if (currentItemIndex >= factChecks.length) {
                showCompletionScreen();
                return;
            }

            const item = factChecks[currentItemIndex];

            // UI 업데이트
            document.getElementById('statement-text').textContent = item.statement;
            document.getElementById('current-index-display').textContent = currentItemIndex + 1;
            document.getElementById('score-display').textContent = score;

            // 4개의 보기 버튼 생성 (옵션을 항상 설정)
            generatePrincipleButtons(item.correct_principle);
            
            // 피드백/힌트 영역 초기화 및 숨기기
            document.getElementById('feedback-area').classList.add('hidden');
            document.getElementById('hint-text').classList.add('hidden');
            document.getElementById('correct-answer-info').classList.add('hidden');
            
            // 버튼 재활성화
            document.querySelectorAll('#answer-buttons button').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-offset-2', 'ring-red-400', 'ring-green-400', 'ring-sky-400', 'disabled');
                btn.classList.remove('opacity-50');
                btn.removeAttribute('disabled');
            });
            document.getElementById('answer-buttons').classList.remove('pointer-events-none');
            
            // 이미 정답을 맞춘 문제라면, 피드백을 바로 표시하고 다음 버튼 활성화
            if (item.isCorrectlyAnswered) {
                // isReplay=true로 설정하여 점수 중복 상승을 방지하고 피드백만 표시
                // awardedPoints는 0으로 전달하여 피드백 텍스트를 간결하게 유지
                submitAnswer(item.userAnswer, true); 
            } else {
                 // 정답을 맞추지 못한 문제라면, 버튼 초기화 상태로 복구
                updateNavigationButtons(false); 
            }
        }

        /**
         * 다음/이전 버튼 상태를 업데이트합니다.
         * @param {boolean} isCorrect - 현재 문제가 정답 상태인지 여부
         */
        function updateNavigationButtons(isCorrect) {
            const nextButton = document.getElementById('next-button');
            const prevButton = document.getElementById('prev-button');
            
            // 이전 버튼 표시 여부
            if (currentItemIndex > 0) {
                prevButton.classList.remove('hidden');
                // 정답을 맞춘 경우에만 다음 버튼과 이전 버튼이 너비를 공유함
                prevButton.classList.toggle('w-1/2', isCorrect); 
            } else {
                prevButton.classList.add('hidden');
            }

            // 다음 버튼 상태 (정답을 맞춘 경우에만 활성화)
            if (isCorrect) {
                nextButton.disabled = false;
                nextButton.classList.remove('opacity-50', 'cursor-not-allowed');
                nextButton.classList.add('hover:bg-teal-600');
                
                // 이전 버튼이 숨겨져 있으면 다음 버튼이 전체 너비를 가짐
                const isPrevHidden = prevButton.classList.contains('hidden');
                nextButton.classList.toggle('w-full', isPrevHidden);
                nextButton.classList.toggle('w-1/2', !isPrevHidden);

                nextButton.textContent = (currentItemIndex === factChecks.length - 1) ? "최종 학습 결과 확인하기" : "다음 문제로 이동";
            } else {
                nextButton.disabled = true;
                nextButton.classList.add('opacity-50', 'cursor-not-allowed');
                nextButton.classList.remove('hover:bg-teal-600', 'w-1/2');
                nextButton.classList.add('w-full');
                nextButton.textContent = "다음 문제로 (정답을 맞추세요)";
            }
        }


        /**
         * 4개의 보기 버튼을 동적으로 생성합니다.
         * @param {string} correctKey - 정답 원칙 키
         */
        function generatePrincipleButtons(correctKey) {
            const container = document.getElementById('answer-buttons');
            container.innerHTML = '';
            
            // 오답 후보 3개 무작위 선택 후 순서 섞기
            const incorrectKeys = principleKeys.filter(key => key !== correctKey);
            const shuffledIncorrectKeys = shuffleArray(incorrectKeys);
            const selectedKeys = [correctKey, ...shuffledIncorrectKeys.slice(0, 3)];
            const shuffledOptions = shuffleArray(selectedKeys);

            // 버튼 생성 및 DOM에 추가
            shuffledOptions.forEach(key => {
                const principle = principles[key];
                const button = document.createElement('button');
                
                button.className = `fact-button py-3 px-2 text-sm md:text-md font-bold rounded-xl ${principle.color} text-white hover:${principle.color.replace('-500', '-600')} shadow-lg ${principle.shadow} transition duration-200`;
                button.setAttribute('data-principle', key);
                button.setAttribute('onclick', `submitAnswer('${key}')`);
                button.textContent = principle.text;
                container.appendChild(button);
            });
        }

        /**
         * 사용자의 답변을 처리하고 피드백을 표시합니다.
         * @param {string} userAnswerPrinciple - 사용자가 선택한 원칙 키
         * @param {boolean} [isReplay=false] - 이미 정답을 맞춘 문제인지 여부
         */
        function submitAnswer(userAnswerPrinciple, isReplay = false) {
            const item = factChecks[currentItemIndex];
            const isCorrect = (userAnswerPrinciple === item.correct_principle);
            let awardedPoints = 0;
            
            // 1. 상태 저장 (재시도를 위해)
            item.userAnswer = userAnswerPrinciple;

            // 오답 처리: 시도 횟수 증가 (이미 정답을 맞춘 문제는 시도 횟수 증가시키지 않음)
            if (!isCorrect && !item.isCorrectlyAnswered) {
                item.attempts++; // 시도 횟수 증가
            }
            
            // 2. 점수 업데이트 및 상태 플래그 설정 (정답을 처음 맞췄을 때만 점수 추가)
            if (isCorrect && !item.isCorrectlyAnswered) {
                const totalAttempts = item.attempts + 1; // 0회 실패 + 1회 성공
                awardedPoints = getScoreForAttempts(totalAttempts); // 점수 계산
                score += awardedPoints;
                item.isCorrectlyAnswered = true;
            } 
            
            // 3. 피드백 표시
            showFeedback(userAnswerPrinciple, item.correct_principle, item, isCorrect, isReplay, awardedPoints);
        }

        /**
         * 피드백 영역을 표시하고, 버튼 상태를 업데이트합니다.
         * @param {string} userAnswer - 사용자가 선택한 원칙 키
         * @param {string} correctKey - 정답 원칙 키
         * @param {object} item - 현재 퀴즈 항목 객체
         * @param {boolean} isCorrect - 정답 여부
         * @param {boolean} isReplay - 재확인 여부
         * @param {number} awardedPoints - 획득한 점수 (0점일 수도 있음)
         */
        function showFeedback(userAnswer, correctKey, item, isCorrect, isReplay, awardedPoints) {
            const feedbackArea = document.getElementById('feedback-area');
            const feedbackTitle = document.getElementById('feedback-title');
            const hintText = document.getElementById('hint-text');
            
            // 피드백 영역 색상/제목 설정
            if (item.isCorrectlyAnswered) { // 이미 정답을 맞춘 상태
                const totalAttempts = item.attempts + 1;

                let titleText = `👍 정답입니다! (${totalAttempts}회 시도)`;
                if (awardedPoints > 0 && !isReplay) {
                    titleText += ` - ${awardedPoints}점 획득!`;
                } else if (awardedPoints === 0 && !isReplay) {
                    titleText += ` - 0점 획득 (5회 이상 시도)`;
                } else if (isReplay) {
                     titleText = "👍 이미 정답을 맞춘 문제입니다.";
                }

                feedbackTitle.textContent = titleText;
                feedbackArea.classList.remove('border-red-400', 'bg-red-50');
                feedbackArea.classList.add('border-green-400', 'bg-green-50');
                feedbackTitle.classList.remove('text-red-600');
                feedbackTitle.classList.add('text-green-600');
                hintText.classList.add('hidden'); // 정답이므로 힌트 숨김
                document.getElementById('correct-answer-info').classList.remove('hidden'); // 정답 표시
                document.getElementById('explanation-text').textContent = item.explanation;
            } else { // 아직 정답을 맞추지 못한 상태 (오답)
                feedbackTitle.textContent = `🤔 오답입니다. 다시 한번 생각해 봅시다. (현재 ${item.attempts}회 실패)`;
                feedbackArea.classList.remove('border-green-400', 'bg-green-50');
                feedbackArea.classList.add('border-red-400', 'bg-red-50');
                feedbackTitle.classList.remove('text-green-600');
                feedbackTitle.classList.add('text-red-600');
                document.getElementById('correct-answer-info').classList.add('hidden'); // 정답 숨김

                // 오답 힌트 제공
                hintText.textContent = `💡 힌트 (${item.attempts + 1}번째 시도): ${principles[correctKey].hint}`;
                hintText.classList.remove('hidden');
                document.getElementById('explanation-text').textContent = "오답입니다. 힌트를 참고하여 다른 원칙을 다시 선택해보세요.";
            }

            document.getElementById('correct-principle-text').textContent = principles[correctKey].text;
            document.getElementById('score-display').textContent = score;
            feedbackArea.classList.remove('hidden');
            
            // 네비게이션 버튼 상태 업데이트 (정답을 맞춘 경우에만 다음 버튼 활성화)
            updateNavigationButtons(item.isCorrectlyAnswered);

            // 버튼 하이라이트
            const buttons = document.querySelectorAll('#answer-buttons button');
            buttons.forEach(btn => {
                const buttonKey = btn.getAttribute('data-principle');
                const isCurrentButton = buttonKey === userAnswer;
                
                btn.classList.remove('ring-4', 'ring-offset-2', 'ring-red-400', 'ring-green-400', 'ring-sky-400');
                btn.classList.remove('disabled', 'opacity-50');
                btn.removeAttribute('disabled');
                
                // 정답을 맞춘 후에는 모든 선택 버튼 비활성화 (navigation button은 활성화됨)
                if (item.isCorrectlyAnswered) {
                    btn.setAttribute('disabled', 'true');
                    btn.classList.add('disabled', 'opacity-50');
                    if (buttonKey === correctKey) {
                        // 정답 버튼을 녹색으로 표시하고 활성화된 것처럼 보이게 함
                        btn.classList.add('ring-4', 'ring-offset-2', 'ring-green-400', 'opacity-100');
                        btn.classList.remove('opacity-50', 'disabled');
                    }
                } else {
                    // 정답을 못 맞췄다면, 오답 처리된 버튼만 붉은색 링 표시
                    if (isCurrentButton && !isCorrect) {
                        btn.classList.add('ring-4', 'ring-offset-2', 'ring-red-400');
                    }
                    // 정답을 못 맞췄다면, 버튼을 계속 누를 수 있도록 전체 비활성화는 막음
                }
            });

            // 정답을 맞추지 못했다면, 버튼을 계속 누를 수 있도록 pointer-events-none 제거 유지
            if (item.isCorrectlyAnswered) {
                document.getElementById('answer-buttons').classList.add('pointer-events-none');
            } else {
                 document.getElementById('answer-buttons').classList.remove('pointer-events-none');
            }
        }

        /**
         * 챌린지 완료 화면을 표시합니다. (STEP 4)
         */
        function showCompletionScreen() {
            showScreen('completion-screen');
            document.getElementById('final-score-display').textContent = score;
            document.getElementById('final-user-info-display').textContent = `${studentInfo.id} ${studentInfo.name}`;
        }
        
        // 애플리케이션 시작: 인트로 화면 호출
        window.onload = function() {
            showIntroScreen();
        };

    </script>
</body>
</html>
